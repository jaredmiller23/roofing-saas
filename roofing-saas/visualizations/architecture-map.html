<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Roofing SaaS - Architecture Map (Layered)</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script>const SCHEMA_DATA = {
  "generated": "2026-02-04T12:32:55.682Z",
  "stats": {
    "tables": 156,
    "relationships": 143,
    "domains": 24
  },
  "domainStats": {
    "Security": {
      "tables": 1,
      "connections": 0
    },
    "Gamification": {
      "tables": 19,
      "connections": 6
    },
    "Activities": {
      "tables": 3,
      "connections": 10
    },
    "Insurance & Claims": {
      "tables": 13,
      "connections": 4
    },
    "Settings & Admin": {
      "tables": 13,
      "connections": 11
    },
    "Voice & AI": {
      "tables": 8,
      "connections": 21
    },
    "AR Assessment": {
      "tables": 3,
      "connections": 5
    },
    "Automations": {
      "tables": 5,
      "connections": 0
    },
    "Knowledge Base": {
      "tables": 8,
      "connections": 4
    },
    "Storm Ops": {
      "tables": 7,
      "connections": 14
    },
    "Digital Cards": {
      "tables": 2,
      "connections": 0
    },
    "Communication": {
      "tables": 8,
      "connections": 13
    },
    "Campaigns": {
      "tables": 6,
      "connections": 24
    },
    "Financial": {
      "tables": 11,
      "connections": 19
    },
    "Contacts": {
      "tables": 1,
      "connections": 16
    },
    "Crew & Costs": {
      "tables": 4,
      "connections": 11
    },
    "Other": {
      "tables": 4,
      "connections": 1
    },
    "Compliance": {
      "tables": 3,
      "connections": 3
    },
    "Documents": {
      "tables": 6,
      "connections": 1
    },
    "Integrations": {
      "tables": 5,
      "connections": 4
    },
    "Field Ops": {
      "tables": 5,
      "connections": 6
    },
    "Projects": {
      "tables": 7,
      "connections": 31
    },
    "Core & Auth": {
      "tables": 10,
      "connections": 70
    },
    "Tasks": {
      "tables": 4,
      "connections": 12
    }
  },
  "nodes": [
    {
      "id": "_encryption_keys",
      "domain": "Security",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "achievement_configs",
      "domain": "Gamification",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "achievements",
      "domain": "Gamification",
      "connections": 0,
      "apiRoutes": 1
    },
    {
      "id": "activities",
      "domain": "Activities",
      "connections": 0,
      "apiRoutes": 33
    },
    {
      "id": "adjuster_patterns",
      "domain": "Insurance & Claims",
      "connections": 1,
      "apiRoutes": 8
    },
    {
      "id": "admin_alerts",
      "domain": "Settings & Admin",
      "connections": 1,
      "apiRoutes": 5
    },
    {
      "id": "ai_conversations",
      "domain": "Voice & AI",
      "connections": 2,
      "apiRoutes": 10
    },
    {
      "id": "ai_messages",
      "domain": "Voice & AI",
      "connections": 1,
      "apiRoutes": 7
    },
    {
      "id": "ar_damage_markers",
      "domain": "AR Assessment",
      "connections": 1,
      "apiRoutes": 0
    },
    {
      "id": "ar_measurements",
      "domain": "AR Assessment",
      "connections": 1,
      "apiRoutes": 0
    },
    {
      "id": "ar_sessions",
      "domain": "AR Assessment",
      "connections": 3,
      "apiRoutes": 0
    },
    {
      "id": "aria_conversations",
      "domain": "Voice & AI",
      "connections": 4,
      "apiRoutes": 0
    },
    {
      "id": "aria_function_logs",
      "domain": "Voice & AI",
      "connections": 2,
      "apiRoutes": 0
    },
    {
      "id": "audit_log",
      "domain": "Settings & Admin",
      "connections": 0,
      "apiRoutes": 4
    },
    {
      "id": "automations",
      "domain": "Automations",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "building_codes",
      "domain": "Knowledge Base",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "bulk_import_jobs",
      "domain": "Storm Ops",
      "connections": 2,
      "apiRoutes": 0
    },
    {
      "id": "business_card_interactions",
      "domain": "Digital Cards",
      "connections": 0,
      "apiRoutes": 3
    },
    {
      "id": "call_compliance_log",
      "domain": "Communication",
      "connections": 3,
      "apiRoutes": 2
    },
    {
      "id": "call_logs",
      "domain": "Communication",
      "connections": 4,
      "apiRoutes": 12
    },
    {
      "id": "call_opt_out_queue",
      "domain": "Communication",
      "connections": 2,
      "apiRoutes": 2
    },
    {
      "id": "callback_requests",
      "domain": "Voice & AI",
      "connections": 3,
      "apiRoutes": 0
    },
    {
      "id": "campaign_analytics",
      "domain": "Campaigns",
      "connections": 2,
      "apiRoutes": 0
    },
    {
      "id": "campaign_enrollments",
      "domain": "Campaigns",
      "connections": 5,
      "apiRoutes": 5
    },
    {
      "id": "campaign_step_executions",
      "domain": "Campaigns",
      "connections": 2,
      "apiRoutes": 2
    },
    {
      "id": "campaign_steps",
      "domain": "Campaigns",
      "connections": 9,
      "apiRoutes": 8
    },
    {
      "id": "campaign_triggers",
      "domain": "Campaigns",
      "connections": 1,
      "apiRoutes": 7
    },
    {
      "id": "campaigns",
      "domain": "Campaigns",
      "connections": 5,
      "apiRoutes": 19
    },
    {
      "id": "carrier_patterns",
      "domain": "Insurance & Claims",
      "connections": 1,
      "apiRoutes": 6
    },
    {
      "id": "carrier_standards",
      "domain": "Insurance & Claims",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "challenge_configs",
      "domain": "Gamification",
      "connections": 1,
      "apiRoutes": 4
    },
    {
      "id": "challenge_progress",
      "domain": "Gamification",
      "connections": 1,
      "apiRoutes": 0
    },
    {
      "id": "challenges",
      "domain": "Gamification",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "claim_communications",
      "domain": "Insurance & Claims",
      "connections": 0,
      "apiRoutes": 3
    },
    {
      "id": "claim_documents",
      "domain": "Insurance & Claims",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "claim_outcomes",
      "domain": "Insurance & Claims",
      "connections": 0,
      "apiRoutes": 4
    },
    {
      "id": "claim_supplements",
      "domain": "Insurance & Claims",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "claim_weather_data",
      "domain": "Insurance & Claims",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "claims",
      "domain": "Insurance & Claims",
      "connections": 0,
      "apiRoutes": 17
    },
    {
      "id": "commission_plans",
      "domain": "Financial",
      "connections": 4,
      "apiRoutes": 0
    },
    {
      "id": "commission_records",
      "domain": "Financial",
      "connections": 6,
      "apiRoutes": 0
    },
    {
      "id": "commission_rules",
      "domain": "Financial",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "commission_summary_by_user",
      "domain": "Financial",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "commissions",
      "domain": "Financial",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "contacts",
      "domain": "Contacts",
      "connections": 16,
      "apiRoutes": 42
    },
    {
      "id": "court_cases",
      "domain": "Insurance & Claims",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "crew_members",
      "domain": "Crew & Costs",
      "connections": 2,
      "apiRoutes": 4
    },
    {
      "id": "dashboards",
      "domain": "Settings & Admin",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "digital_business_cards",
      "domain": "Digital Cards",
      "connections": 0,
      "apiRoutes": 12
    },
    {
      "id": "discontinued_shingles",
      "domain": "Other",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "dnc_imports",
      "domain": "Compliance",
      "connections": 1,
      "apiRoutes": 2
    },
    {
      "id": "dnc_registry",
      "domain": "Compliance",
      "connections": 1,
      "apiRoutes": 3
    },
    {
      "id": "dnc_sync_jobs",
      "domain": "Compliance",
      "connections": 1,
      "apiRoutes": 1
    },
    {
      "id": "document_templates",
      "domain": "Documents",
      "connections": 1,
      "apiRoutes": 6
    },
    {
      "id": "documents",
      "domain": "Documents",
      "connections": 0,
      "apiRoutes": 5
    },
    {
      "id": "email_drafts",
      "domain": "Communication",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "email_templates",
      "domain": "Communication",
      "connections": 1,
      "apiRoutes": 4
    },
    {
      "id": "events",
      "domain": "Activities",
      "connections": 6,
      "apiRoutes": 5
    },
    {
      "id": "extracted_addresses",
      "domain": "Storm Ops",
      "connections": 3,
      "apiRoutes": 7
    },
    {
      "id": "filter_configs",
      "domain": "Settings & Admin",
      "connections": 2,
      "apiRoutes": 4
    },
    {
      "id": "filter_usage_logs",
      "domain": "Settings & Admin",
      "connections": 3,
      "apiRoutes": 0
    },
    {
      "id": "financial_configs",
      "domain": "Financial",
      "connections": 0,
      "apiRoutes": 4
    },
    {
      "id": "gamification_activities",
      "domain": "Gamification",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "gamification_scores",
      "domain": "Gamification",
      "connections": 0,
      "apiRoutes": 4
    },
    {
      "id": "google_calendar_tokens",
      "domain": "Integrations",
      "connections": 1,
      "apiRoutes": 4
    },
    {
      "id": "high_priority_pins",
      "domain": "Field Ops",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "impersonation_logs",
      "domain": "Settings & Admin",
      "connections": 1,
      "apiRoutes": 4
    },
    {
      "id": "industry_organizations",
      "domain": "Knowledge Base",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "industry_standards",
      "domain": "Knowledge Base",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "insurance_carriers",
      "domain": "Insurance & Claims",
      "connections": 1,
      "apiRoutes": 5
    },
    {
      "id": "insurance_personnel",
      "domain": "Insurance & Claims",
      "connections": 1,
      "apiRoutes": 15
    },
    {
      "id": "invoices",
      "domain": "Financial",
      "connections": 2,
      "apiRoutes": 0
    },
    {
      "id": "job_expenses",
      "domain": "Crew & Costs",
      "connections": 3,
      "apiRoutes": 7
    },
    {
      "id": "jobs",
      "domain": "Projects",
      "connections": 4,
      "apiRoutes": 10
    },
    {
      "id": "knocks",
      "domain": "Field Ops",
      "connections": 3,
      "apiRoutes": 12
    },
    {
      "id": "knowledge_search_queries",
      "domain": "Knowledge Base",
      "connections": 2,
      "apiRoutes": 7
    },
    {
      "id": "kpi_definitions",
      "domain": "Gamification",
      "connections": 1,
      "apiRoutes": 7
    },
    {
      "id": "kpi_snapshots",
      "domain": "Gamification",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "kpi_values",
      "domain": "Gamification",
      "connections": 1,
      "apiRoutes": 0
    },
    {
      "id": "lead_scoring_configs",
      "domain": "Settings & Admin",
      "connections": 0,
      "apiRoutes": 4
    },
    {
      "id": "leaderboard",
      "domain": "Gamification",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "login_activity",
      "domain": "Core & Auth",
      "connections": 1,
      "apiRoutes": 0
    },
    {
      "id": "manufacturer_directory",
      "domain": "Knowledge Base",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "manufacturer_specs",
      "domain": "Knowledge Base",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "material_purchases",
      "domain": "Crew & Costs",
      "connections": 3,
      "apiRoutes": 4
    },
    {
      "id": "n8n_chat_histories",
      "domain": "Other",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "packets",
      "domain": "Documents",
      "connections": 0,
      "apiRoutes": 2
    },
    {
      "id": "photos",
      "domain": "Other",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "pins_pending_sync",
      "domain": "Field Ops",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "pipeline_metrics",
      "domain": "Settings & Admin",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "pipeline_stages",
      "domain": "Settings & Admin",
      "connections": 1,
      "apiRoutes": 4
    },
    {
      "id": "point_rule_configs",
      "domain": "Gamification",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "point_rules",
      "domain": "Gamification",
      "connections": 0,
      "apiRoutes": 4
    },
    {
      "id": "policy_provisions",
      "domain": "Insurance & Claims",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "project_files",
      "domain": "Projects",
      "connections": 2,
      "apiRoutes": 35
    },
    {
      "id": "project_profit_loss",
      "domain": "Projects",
      "connections": 0,
      "apiRoutes": 3
    },
    {
      "id": "projects",
      "domain": "Projects",
      "connections": 17,
      "apiRoutes": 38
    },
    {
      "id": "property_enrichment_cache",
      "domain": "Storm Ops",
      "connections": 1,
      "apiRoutes": 0
    },
    {
      "id": "query_history",
      "domain": "Settings & Admin",
      "connections": 0,
      "apiRoutes": 5
    },
    {
      "id": "quickbooks_connections",
      "domain": "Integrations",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "quickbooks_mappings",
      "domain": "Integrations",
      "connections": 1,
      "apiRoutes": 0
    },
    {
      "id": "quickbooks_sync_logs",
      "domain": "Integrations",
      "connections": 1,
      "apiRoutes": 0
    },
    {
      "id": "quickbooks_tokens",
      "domain": "Integrations",
      "connections": 1,
      "apiRoutes": 6
    },
    {
      "id": "quote_line_items",
      "domain": "Projects",
      "connections": 1,
      "apiRoutes": 4
    },
    {
      "id": "quote_options",
      "domain": "Projects",
      "connections": 4,
      "apiRoutes": 9
    },
    {
      "id": "quote_proposals",
      "domain": "Projects",
      "connections": 3,
      "apiRoutes": 0
    },
    {
      "id": "recording_consent_states",
      "domain": "Communication",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "rep_locations",
      "domain": "Field Ops",
      "connections": 1,
      "apiRoutes": 0
    },
    {
      "id": "report_schedules",
      "domain": "Settings & Admin",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "revenue_forecast",
      "domain": "Financial",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "reward_claims",
      "domain": "Gamification",
      "connections": 1,
      "apiRoutes": 0
    },
    {
      "id": "reward_configs",
      "domain": "Gamification",
      "connections": 1,
      "apiRoutes": 6
    },
    {
      "id": "roofing_knowledge",
      "domain": "Knowledge Base",
      "connections": 2,
      "apiRoutes": 7
    },
    {
      "id": "saved_filters",
      "domain": "Settings & Admin",
      "connections": 2,
      "apiRoutes": 8
    },
    {
      "id": "shingle_products",
      "domain": "Knowledge Base",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "signature_documents",
      "domain": "Documents",
      "connections": 0,
      "apiRoutes": 22
    },
    {
      "id": "signatures",
      "domain": "Documents",
      "connections": 0,
      "apiRoutes": 6
    },
    {
      "id": "sms_approval_queue",
      "domain": "Communication",
      "connections": 2,
      "apiRoutes": 4
    },
    {
      "id": "sms_templates",
      "domain": "Communication",
      "connections": 1,
      "apiRoutes": 4
    },
    {
      "id": "status_substatus_configs",
      "domain": "Settings & Admin",
      "connections": 1,
      "apiRoutes": 7
    },
    {
      "id": "storm_alerts",
      "domain": "Storm Ops",
      "connections": 1,
      "apiRoutes": 4
    },
    {
      "id": "storm_events",
      "domain": "Storm Ops",
      "connections": 3,
      "apiRoutes": 3
    },
    {
      "id": "storm_response_mode",
      "domain": "Storm Ops",
      "connections": 1,
      "apiRoutes": 5
    },
    {
      "id": "storm_targeting_areas",
      "domain": "Storm Ops",
      "connections": 3,
      "apiRoutes": 4
    },
    {
      "id": "subscription_events",
      "domain": "Financial",
      "connections": 2,
      "apiRoutes": 0
    },
    {
      "id": "subscriptions",
      "domain": "Financial",
      "connections": 3,
      "apiRoutes": 3
    },
    {
      "id": "surveys",
      "domain": "Activities",
      "connections": 4,
      "apiRoutes": 5
    },
    {
      "id": "task_activity",
      "domain": "Tasks",
      "connections": 1,
      "apiRoutes": 2
    },
    {
      "id": "task_attachments",
      "domain": "Tasks",
      "connections": 1,
      "apiRoutes": 0
    },
    {
      "id": "task_comments",
      "domain": "Tasks",
      "connections": 1,
      "apiRoutes": 0
    },
    {
      "id": "tasks",
      "domain": "Tasks",
      "connections": 9,
      "apiRoutes": 6
    },
    {
      "id": "templates",
      "domain": "Documents",
      "connections": 0,
      "apiRoutes": 4
    },
    {
      "id": "tenant_settings",
      "domain": "Core & Auth",
      "connections": 1,
      "apiRoutes": 6
    },
    {
      "id": "tenant_users",
      "domain": "Core & Auth",
      "connections": 0,
      "apiRoutes": 36
    },
    {
      "id": "tenants",
      "domain": "Core & Auth",
      "connections": 61,
      "apiRoutes": 7
    },
    {
      "id": "territories",
      "domain": "Field Ops",
      "connections": 2,
      "apiRoutes": 9
    },
    {
      "id": "timesheets",
      "domain": "Crew & Costs",
      "connections": 3,
      "apiRoutes": 4
    },
    {
      "id": "user_achievements",
      "domain": "Gamification",
      "connections": 0,
      "apiRoutes": 1
    },
    {
      "id": "user_challenges",
      "domain": "Gamification",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "user_commission_assignments",
      "domain": "Financial",
      "connections": 2,
      "apiRoutes": 0
    },
    {
      "id": "user_notification_preferences",
      "domain": "Core & Auth",
      "connections": 1,
      "apiRoutes": 2
    },
    {
      "id": "user_points",
      "domain": "Gamification",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "user_role_assignments",
      "domain": "Core & Auth",
      "connections": 2,
      "apiRoutes": 4
    },
    {
      "id": "user_roles",
      "domain": "Core & Auth",
      "connections": 2,
      "apiRoutes": 6
    },
    {
      "id": "user_sessions",
      "domain": "Core & Auth",
      "connections": 1,
      "apiRoutes": 0
    },
    {
      "id": "user_streaks",
      "domain": "Gamification",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "user_ui_preferences",
      "domain": "Core & Auth",
      "connections": 1,
      "apiRoutes": 0
    },
    {
      "id": "users",
      "domain": "Core & Auth",
      "connections": 0,
      "apiRoutes": 9
    },
    {
      "id": "voice_function_calls",
      "domain": "Voice & AI",
      "connections": 2,
      "apiRoutes": 0
    },
    {
      "id": "voice_sessions",
      "domain": "Voice & AI",
      "connections": 4,
      "apiRoutes": 3
    },
    {
      "id": "voicemail_messages",
      "domain": "Voice & AI",
      "connections": 3,
      "apiRoutes": 2
    },
    {
      "id": "win_loss_reasons",
      "domain": "Other",
      "connections": 1,
      "apiRoutes": 0
    },
    {
      "id": "workflow_executions",
      "domain": "Automations",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "workflow_step_executions",
      "domain": "Automations",
      "connections": 0,
      "apiRoutes": 0
    },
    {
      "id": "workflow_steps",
      "domain": "Automations",
      "connections": 0,
      "apiRoutes": 1
    },
    {
      "id": "workflows",
      "domain": "Automations",
      "connections": 0,
      "apiRoutes": 6
    }
  ],
  "links": [
    {
      "source": "voice_sessions",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "voice_sessions",
      "target": "contacts",
      "column": "contact_id"
    },
    {
      "source": "voice_sessions",
      "target": "projects",
      "column": "contact"
    },
    {
      "source": "voice_function_calls",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "voice_function_calls",
      "target": "voice_sessions",
      "column": "session_id"
    },
    {
      "source": "tasks",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "tasks",
      "target": "projects",
      "column": "project_id"
    },
    {
      "source": "tasks",
      "target": "contacts",
      "column": "contact_id"
    },
    {
      "source": "project_files",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "project_files",
      "target": "projects",
      "column": "project_id"
    },
    {
      "source": "call_logs",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "call_logs",
      "target": "contacts",
      "column": "relationships"
    },
    {
      "source": "call_logs",
      "target": "projects",
      "column": "project_id"
    },
    {
      "source": "rep_locations",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "knocks",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "knocks",
      "target": "contacts",
      "column": "creation"
    },
    {
      "source": "knocks",
      "target": "territories",
      "column": "tracking"
    },
    {
      "source": "territories",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "jobs",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "jobs",
      "target": "projects",
      "column": "project_id"
    },
    {
      "source": "events",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "events",
      "target": "contacts",
      "column": "Relationships"
    },
    {
      "source": "events",
      "target": "projects",
      "column": "project_id"
    },
    {
      "source": "events",
      "target": "jobs",
      "column": "job_id"
    },
    {
      "source": "events",
      "target": "events",
      "column": "format"
    },
    {
      "source": "surveys",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "surveys",
      "target": "projects",
      "column": "relationships"
    },
    {
      "source": "surveys",
      "target": "contacts",
      "column": "contact_id"
    },
    {
      "source": "surveys",
      "target": "jobs",
      "column": "job_id"
    },
    {
      "source": "tasks",
      "target": "projects",
      "column": "Relationships"
    },
    {
      "source": "tasks",
      "target": "tasks",
      "column": "parent_task_id"
    },
    {
      "source": "task_comments",
      "target": "tasks",
      "column": "task_id"
    },
    {
      "source": "task_attachments",
      "target": "tasks",
      "column": "task_id"
    },
    {
      "source": "task_activity",
      "target": "tasks",
      "column": "task_id"
    },
    {
      "source": "tenant_settings",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "pipeline_stages",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "win_loss_reasons",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "email_templates",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "sms_templates",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "user_roles",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "user_role_assignments",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "user_role_assignments",
      "target": "user_roles",
      "column": "role_id"
    },
    {
      "source": "quickbooks_tokens",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "quickbooks_sync_logs",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "quickbooks_mappings",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "job_expenses",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "job_expenses",
      "target": "projects",
      "column": "project_id"
    },
    {
      "source": "job_expenses",
      "target": "contacts",
      "column": "vendor_id"
    },
    {
      "source": "crew_members",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "timesheets",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "timesheets",
      "target": "projects",
      "column": "project_id"
    },
    {
      "source": "timesheets",
      "target": "crew_members",
      "column": "crew_member_id"
    },
    {
      "source": "material_purchases",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "material_purchases",
      "target": "projects",
      "column": "project_id"
    },
    {
      "source": "material_purchases",
      "target": "contacts",
      "column": "supplier_id"
    },
    {
      "source": "roofing_knowledge",
      "target": "tenants",
      "column": "support"
    },
    {
      "source": "knowledge_search_queries",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "knowledge_search_queries",
      "target": "roofing_knowledge",
      "column": "top_result_id"
    },
    {
      "source": "commission_plans",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "commission_records",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "commission_records",
      "target": "commission_plans",
      "column": "commission_plan_id"
    },
    {
      "source": "commission_records",
      "target": "projects",
      "column": "for"
    },
    {
      "source": "commission_records",
      "target": "contacts",
      "column": "contact_id"
    },
    {
      "source": "user_commission_assignments",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "user_commission_assignments",
      "target": "commission_plans",
      "column": "commission_plan_id"
    },
    {
      "source": "storm_targeting_areas",
      "target": "storm_events",
      "column": "Association"
    },
    {
      "source": "bulk_import_jobs",
      "target": "storm_targeting_areas",
      "column": "Association"
    },
    {
      "source": "extracted_addresses",
      "target": "storm_targeting_areas",
      "column": "Association"
    },
    {
      "source": "extracted_addresses",
      "target": "bulk_import_jobs",
      "column": "bulk_import_job_id"
    },
    {
      "source": "extracted_addresses",
      "target": "property_enrichment_cache",
      "column": "enrichment_cache_id"
    },
    {
      "source": "campaigns",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "campaign_triggers",
      "target": "campaigns",
      "column": "campaign_id"
    },
    {
      "source": "campaign_steps",
      "target": "campaigns",
      "column": "campaign_id"
    },
    {
      "source": "campaign_steps",
      "target": "campaign_steps",
      "column": "parent_step_id"
    },
    {
      "source": "campaign_steps",
      "target": "campaign_steps",
      "column": "type"
    },
    {
      "source": "campaign_steps",
      "target": "campaign_steps",
      "column": "false_path_step_id"
    },
    {
      "source": "campaign_enrollments",
      "target": "campaigns",
      "column": "campaign_id"
    },
    {
      "source": "campaign_enrollments",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "campaign_enrollments",
      "target": "contacts",
      "column": "enrolled"
    },
    {
      "source": "campaign_enrollments",
      "target": "campaign_steps",
      "column": "current_step_id"
    },
    {
      "source": "campaign_step_executions",
      "target": "campaign_enrollments",
      "column": "enrollment_id"
    },
    {
      "source": "campaign_step_executions",
      "target": "campaign_steps",
      "column": "step_id"
    },
    {
      "source": "campaign_analytics",
      "target": "campaigns",
      "column": "campaign_id"
    },
    {
      "source": "campaign_analytics",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "impersonation_logs",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "ai_conversations",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "ai_messages",
      "target": "ai_conversations",
      "column": "conversation_id"
    },
    {
      "source": "filter_configs",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "saved_filters",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "filter_usage_logs",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "filter_usage_logs",
      "target": "filter_configs",
      "column": "details"
    },
    {
      "source": "filter_usage_logs",
      "target": "saved_filters",
      "column": "saved_filter_id"
    },
    {
      "source": "status_substatus_configs",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "challenge_progress",
      "target": "challenge_configs",
      "column": "challenge_id"
    },
    {
      "source": "reward_claims",
      "target": "reward_configs",
      "column": "reward_id"
    },
    {
      "source": "kpi_values",
      "target": "kpi_definitions",
      "column": "kpi_id"
    },
    {
      "source": "callback_requests",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "callback_requests",
      "target": "contacts",
      "column": "contact_id"
    },
    {
      "source": "voicemail_messages",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "voicemail_messages",
      "target": "contacts",
      "column": "contact_id"
    },
    {
      "source": "voicemail_messages",
      "target": "callback_requests",
      "column": "callback_request_id"
    },
    {
      "source": "aria_conversations",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "aria_conversations",
      "target": "contacts",
      "column": "internal"
    },
    {
      "source": "aria_conversations",
      "target": "projects",
      "column": "Context"
    },
    {
      "source": "aria_function_logs",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "aria_function_logs",
      "target": "aria_conversations",
      "column": "Context"
    },
    {
      "source": "user_notification_preferences",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "user_sessions",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "login_activity",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "dnc_registry",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "dnc_imports",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "call_compliance_log",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "call_compliance_log",
      "target": "call_logs",
      "column": "records"
    },
    {
      "source": "call_compliance_log",
      "target": "contacts",
      "column": "contact_id"
    },
    {
      "source": "quote_options",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "quote_options",
      "target": "projects",
      "column": "project_id"
    },
    {
      "source": "quote_line_items",
      "target": "quote_options",
      "column": "quote_option_id"
    },
    {
      "source": "quote_proposals",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "quote_proposals",
      "target": "projects",
      "column": "project_id"
    },
    {
      "source": "quote_proposals",
      "target": "quote_options",
      "column": "selected_option_id"
    },
    {
      "source": "storm_alerts",
      "target": "storm_events",
      "column": "Association"
    },
    {
      "source": "storm_response_mode",
      "target": "storm_events",
      "column": "storm_event_id"
    },
    {
      "source": "ar_sessions",
      "target": "projects",
      "column": "project_id"
    },
    {
      "source": "ar_measurements",
      "target": "ar_sessions",
      "column": "session_id"
    },
    {
      "source": "ar_damage_markers",
      "target": "ar_sessions",
      "column": "session_id"
    },
    {
      "source": "commission_records",
      "target": "commission_plans",
      "column": "plan_id"
    },
    {
      "source": "commission_records",
      "target": "projects",
      "column": "project_id"
    },
    {
      "source": "document_templates",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "user_ui_preferences",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "call_opt_out_queue",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "call_opt_out_queue",
      "target": "contacts",
      "column": "contact_id"
    },
    {
      "source": "dnc_sync_jobs",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "admin_alerts",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "adjuster_patterns",
      "target": "insurance_personnel",
      "column": "adjuster_id"
    },
    {
      "source": "carrier_patterns",
      "target": "insurance_carriers",
      "column": "carrier_id"
    },
    {
      "source": "subscriptions",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "subscription_events",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "subscription_events",
      "target": "subscriptions",
      "column": "subscription_id"
    },
    {
      "source": "invoices",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "invoices",
      "target": "subscriptions",
      "column": "subscription_id"
    },
    {
      "source": "sms_approval_queue",
      "target": "tenants",
      "column": "tenant_id"
    },
    {
      "source": "sms_approval_queue",
      "target": "contacts",
      "column": "contact_id"
    },
    {
      "source": "google_calendar_tokens",
      "target": "tenants",
      "column": "tenant_id"
    }
  ]
};</script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #0f1219;
    color: #e0e0e0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    min-height: 100vh;
    padding: 32px;
  }
  h1 {
    font-size: 28px;
    font-weight: 700;
    color: #FF8243;
    margin-bottom: 4px;
  }
  .subtitle {
    font-size: 14px;
    color: #6b7280;
    margin-bottom: 24px;
  }
  .stats-bar {
    display: flex;
    gap: 32px;
    margin-bottom: 32px;
    padding: 16px 24px;
    background: rgba(45,51,64,0.5);
    border-radius: 12px;
    border: 1px solid #404854;
  }
  .stats-bar .stat-value {
    font-size: 28px;
    font-weight: 800;
    color: #fff;
  }
  .stats-bar .stat-label {
    font-size: 11px;
    color: #6b7280;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  .domains-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 16px;
    margin-bottom: 48px;
  }
  .domain-card {
    background: rgba(30,35,50,0.8);
    border: 1px solid #2d3340;
    border-radius: 12px;
    padding: 16px 20px;
    transition: border-color 0.2s, transform 0.2s;
    cursor: default;
  }
  .domain-card:hover {
    border-color: var(--domain-color, #404854);
    transform: translateY(-2px);
  }
  .domain-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
  }
  .domain-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  .domain-name {
    font-size: 15px;
    font-weight: 700;
    color: #fff;
  }
  .domain-count {
    margin-left: auto;
    font-size: 12px;
    color: #6b7280;
    background: rgba(255,255,255,0.05);
    padding: 2px 8px;
    border-radius: 10px;
  }
  .table-list {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }
  .table-chip {
    font-size: 11px;
    padding: 4px 8px;
    border-radius: 6px;
    background: rgba(255,255,255,0.05);
    color: #9ca3af;
    border: 1px solid rgba(255,255,255,0.06);
    white-space: nowrap;
    transition: background 0.15s, color 0.15s;
  }
  .table-chip:hover {
    background: rgba(255,255,255,0.1);
    color: #e0e0e0;
  }
  .table-chip.hub {
    color: var(--domain-color, #e0e0e0);
    border-color: var(--domain-color, #404854);
    font-weight: 600;
  }
  .connections-section {
    margin-top: 48px;
  }
  .connections-section h2 {
    font-size: 20px;
    font-weight: 700;
    color: #fff;
    margin-bottom: 16px;
  }
  .connection-matrix {
    width: 100%;
    overflow-x: auto;
  }
  #matrix-svg {
    display: block;
    margin: 0 auto;
  }
  .cross-domain {
    margin-top: 48px;
  }
  .cross-domain h2 {
    font-size: 20px;
    font-weight: 700;
    color: #fff;
    margin-bottom: 8px;
  }
  .cross-domain p {
    font-size: 13px;
    color: #6b7280;
    margin-bottom: 16px;
  }
  .hub-table {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 12px 16px;
    background: rgba(45,51,64,0.4);
    border-radius: 10px;
    margin-bottom: 8px;
    border: 1px solid #2d3340;
  }
  .hub-name {
    font-weight: 700;
    font-size: 14px;
    color: #fff;
    min-width: 180px;
  }
  .hub-domain {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    min-width: 120px;
  }
  .hub-bar {
    flex: 1;
    height: 8px;
    background: rgba(255,255,255,0.05);
    border-radius: 4px;
    overflow: hidden;
  }
  .hub-bar-fill {
    height: 100%;
    border-radius: 4px;
    transition: width 0.5s ease;
  }
  .hub-count {
    font-size: 13px;
    font-weight: 600;
    color: #9ca3af;
    min-width: 40px;
    text-align: right;
  }
  footer {
    margin-top: 48px;
    padding-top: 24px;
    border-top: 1px solid #2d3340;
    font-size: 12px;
    color: #4b5563;
    text-align: center;
  }
</style>
</head>
<body>
<h1>Roofing SaaS - Architecture Map</h1>
<div class="subtitle">Appalachian Storm Restoration - JobClarity Platform - Domain-Grouped View</div>

<div class="stats-bar" id="stats-bar"></div>
<div class="domains-grid" id="domains-grid"></div>

<div class="cross-domain">
  <h2>Hub Tables (Most Connected)</h2>
  <p>These tables are the backbone of the system - they connect the most domains together.</p>
  <div id="hub-tables"></div>
</div>

<div class="connections-section">
  <h2>Cross-Domain Connection Matrix</h2>
  <div class="connection-matrix">
    <svg id="matrix-svg"></svg>
  </div>
</div>

<footer>
  Generated from source code - <span id="gen-date"></span> -
  Roofing SaaS by Clarity AI
</footer>

<script>
const DOMAIN_COLORS = {
  'Core & Auth': '#FF8243',
  'Contacts': '#60A5FA',
  'Projects': '#34D399',
  'Tasks': '#2DD4BF',
  'Activities': '#FB923C',
  'Communication': '#F97316',
  'Campaigns': '#A78BFA',
  'Automations': '#818CF8',
  'Insurance & Claims': '#F472B6',
  'Storm Ops': '#EF4444',
  'Field Ops': '#22C55E',
  'Voice & AI': '#06B6D4',
  'Financial': '#10B981',
  'Crew & Costs': '#84CC16',
  'Gamification': '#FBBF24',
  'Documents': '#D97706',
  'Knowledge Base': '#A3E635',
  'Digital Cards': '#E879F9',
  'Integrations': '#6366F1',
  'AR Assessment': '#C084FC',
  'Compliance': '#FB7185',
  'Settings & Admin': '#94A3B8',
  'Security': '#F87171',
  'Other': '#6B7280',
};

async function init() {
  const data = SCHEMA_DATA;

  document.getElementById('gen-date').textContent = new Date(data.generated).toLocaleDateString();

  // Stats bar
  const statsBar = document.getElementById('stats-bar');
  const statsData = [
    { value: data.stats.tables, label: 'Database Tables' },
    { value: data.stats.relationships, label: 'Foreign Keys' },
    { value: data.stats.domains, label: 'Feature Domains' },
    { value: '254', label: 'API Endpoints' },
    { value: '109', label: 'Page Routes' },
  ];
  statsData.forEach(s => {
    const div = document.createElement('div');
    const valDiv = document.createElement('div');
    valDiv.className = 'stat-value';
    valDiv.textContent = s.value;
    div.appendChild(valDiv);
    const lblDiv = document.createElement('div');
    lblDiv.className = 'stat-label';
    lblDiv.textContent = s.label;
    div.appendChild(lblDiv);
    statsBar.appendChild(div);
  });

  // Group nodes by domain
  const domains = {};
  data.nodes.forEach(n => {
    if (!domains[n.domain]) domains[n.domain] = [];
    domains[n.domain].push(n);
  });

  // Sort domains by table count descending
  const sortedDomains = Object.entries(domains).sort((a, b) => b[1].length - a[1].length);

  // Domain cards
  const grid = document.getElementById('domains-grid');
  sortedDomains.forEach(([domain, tables]) => {
    const color = DOMAIN_COLORS[domain] || '#6B7280';
    const card = document.createElement('div');
    card.className = 'domain-card';
    card.style.setProperty('--domain-color', color);

    const header = document.createElement('div');
    header.className = 'domain-header';

    const dot = document.createElement('div');
    dot.className = 'domain-dot';
    dot.style.background = color;
    header.appendChild(dot);

    const name = document.createElement('span');
    name.className = 'domain-name';
    name.textContent = domain;
    header.appendChild(name);

    const count = document.createElement('span');
    count.className = 'domain-count';
    count.textContent = tables.length + ' tables';
    header.appendChild(count);

    card.appendChild(header);

    const tableList = document.createElement('div');
    tableList.className = 'table-list';

    // Sort tables: most connected first
    tables.sort((a, b) => b.connections - a.connections);
    tables.forEach(t => {
      const chip = document.createElement('span');
      chip.className = 'table-chip' + (t.connections >= 5 ? ' hub' : '');
      chip.style.setProperty('--domain-color', color);
      chip.textContent = t.id.replace(/_/g, ' ');
      chip.title = t.connections + ' connections, ' + t.apiRoutes + ' API routes';
      tableList.appendChild(chip);
    });

    card.appendChild(tableList);
    grid.appendChild(card);
  });

  // Hub tables (most connected)
  const hubContainer = document.getElementById('hub-tables');
  const maxConn = Math.max(...data.nodes.map(n => n.connections));
  const hubs = data.nodes.filter(n => n.connections >= 4).sort((a, b) => b.connections - a.connections);

  hubs.forEach(h => {
    const color = DOMAIN_COLORS[h.domain] || '#6B7280';
    const row = document.createElement('div');
    row.className = 'hub-table';

    const nameSpan = document.createElement('span');
    nameSpan.className = 'hub-name';
    nameSpan.textContent = h.id.replace(/_/g, ' ');
    row.appendChild(nameSpan);

    const domainSpan = document.createElement('span');
    domainSpan.className = 'hub-domain';
    domainSpan.style.color = color;
    domainSpan.textContent = h.domain;
    row.appendChild(domainSpan);

    const bar = document.createElement('div');
    bar.className = 'hub-bar';
    const fill = document.createElement('div');
    fill.className = 'hub-bar-fill';
    fill.style.width = (h.connections / maxConn * 100) + '%';
    fill.style.background = color;
    bar.appendChild(fill);
    row.appendChild(bar);

    const countSpan = document.createElement('span');
    countSpan.className = 'hub-count';
    countSpan.textContent = h.connections;
    row.appendChild(countSpan);

    hubContainer.appendChild(row);
  });

  // Cross-domain connection matrix
  buildMatrix(data, sortedDomains);
}

function buildMatrix(data, sortedDomains) {
  const domainNames = sortedDomains.map(d => d[0]);
  const nodeMap = {};
  data.nodes.forEach(n => nodeMap[n.id] = n.domain);

  // Count cross-domain connections
  const matrix = {};
  domainNames.forEach(d1 => {
    matrix[d1] = {};
    domainNames.forEach(d2 => matrix[d1][d2] = 0);
  });

  data.links.forEach(l => {
    const sd = nodeMap[l.source] || nodeMap[l.source?.id];
    const td = nodeMap[l.target] || nodeMap[l.target?.id];
    if (sd && td) {
      matrix[sd][td]++;
      if (sd !== td) matrix[td][sd]++;
    }
  });

  const n = domainNames.length;
  const cellSize = 28;
  const labelWidth = 140;
  const svgWidth = labelWidth + n * cellSize + 20;
  const svgHeight = labelWidth + n * cellSize + 20;

  const svg = d3.select('#matrix-svg')
    .attr('width', svgWidth)
    .attr('height', svgHeight);

  const g = svg.append('g')
    .attr('transform', 'translate(' + labelWidth + ',' + labelWidth + ')');

  // Find max for color scale
  let maxVal = 0;
  domainNames.forEach(d1 => domainNames.forEach(d2 => {
    if (matrix[d1][d2] > maxVal) maxVal = matrix[d1][d2];
  }));

  // Cells
  domainNames.forEach((d1, i) => {
    domainNames.forEach((d2, j) => {
      const val = matrix[d1][d2];
      const opacity = val > 0 ? 0.2 + (val / maxVal) * 0.8 : 0;
      const color = (d1 === d2) ? (DOMAIN_COLORS[d1] || '#6B7280') : '#FF8243';
      g.append('rect')
        .attr('x', j * cellSize)
        .attr('y', i * cellSize)
        .attr('width', cellSize - 2)
        .attr('height', cellSize - 2)
        .attr('rx', 3)
        .attr('fill', val > 0 ? color : 'rgba(255,255,255,0.02)')
        .attr('fill-opacity', opacity);

      if (val > 0) {
        g.append('text')
          .attr('x', j * cellSize + cellSize / 2 - 1)
          .attr('y', i * cellSize + cellSize / 2 + 1)
          .attr('text-anchor', 'middle')
          .attr('dominant-baseline', 'middle')
          .attr('font-size', 9)
          .attr('fill', opacity > 0.5 ? '#fff' : '#9ca3af')
          .attr('font-weight', val >= 5 ? '700' : '400')
          .text(val);
      }
    });
  });

  // Row labels (left)
  domainNames.forEach((d, i) => {
    svg.append('text')
      .attr('x', labelWidth - 6)
      .attr('y', labelWidth + i * cellSize + cellSize / 2)
      .attr('text-anchor', 'end')
      .attr('dominant-baseline', 'middle')
      .attr('font-size', 10)
      .attr('fill', DOMAIN_COLORS[d] || '#6B7280')
      .text(d);
  });

  // Column labels (top, rotated)
  domainNames.forEach((d, j) => {
    svg.append('text')
      .attr('transform', 'translate(' + (labelWidth + j * cellSize + cellSize / 2) + ',' + (labelWidth - 6) + ') rotate(-45)')
      .attr('text-anchor', 'start')
      .attr('font-size', 10)
      .attr('fill', DOMAIN_COLORS[d] || '#6B7280')
      .text(d);
  });
}

init();
</script>
</body>
</html>
